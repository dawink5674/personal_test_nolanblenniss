# =============================================================================
# CCDC NTP Client - Hub-and-Spoke Architecture
# =============================================================================
# Points ONLY to internal Master server (no internet dependency).
# Generated by Ansible for: {{ inventory_hostname }}
# =============================================================================

# -----------------------------------------------------------------------------
# SINGLE AUTHORITATIVE SOURCE: Internal Master NTP Server
# -----------------------------------------------------------------------------
# This is the ONLY time source. No public pools = no internet dependency.
# 'prefer' marks this as the preferred source
# 'iburst' sends 4 packets at startup for fast initial sync
server {{ ntp_master_ip | default('172.20.242.104') }} iburst prefer

# -----------------------------------------------------------------------------
# TIME STEPPING: Aggressive sync for quick convergence
# -----------------------------------------------------------------------------
# makestep <threshold> <limit>
# threshold: step clock if offset exceeds this many seconds
# limit: -1 means unlimited steps (always step if needed)
makestep {{ ntp_makestep_threshold | default(1.0) }} {{ ntp_makestep_limit | default(-1) }}

# -----------------------------------------------------------------------------
# HARDWARE CLOCK SYNC
# -----------------------------------------------------------------------------
rtcsync

# -----------------------------------------------------------------------------
# DRIFT FILE (Stores clock frequency offset)
# -----------------------------------------------------------------------------
driftfile /var/lib/chrony/drift

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------
logdir /var/log/chrony
log tracking measurements statistics